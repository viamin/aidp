# AIDP Firewall Allowlist Configuration
# This file defines domains and IP ranges allowed through the devcontainer firewall
#
# Usage:
#   - Static IP ranges are always applied
#   - Domains are resolved dynamically and their IPs are allowed
#   - Provider-specific requirements are collected from provider classes
#   - GitHub IP ranges are fetched dynamically from GitHub's Meta API
#
# Note: This file is used by .devcontainer/init-firewall.sh

version: 1

# Static IP ranges (CIDR notation)
# These ranges are always allowed regardless of DNS resolution
static_ip_ranges:
  # GitHub infrastructure
  - cidr: "140.82.112.0/20"
    comment: "GitHub main infrastructure (covers 140.82.112.0 - 140.82.127.255)"

  # Localhost
  - cidr: "127.0.0.0/8"
    comment: "Localhost loopback"

# Azure IP ranges for GitHub Copilot and VS Code services
# These use broader /16 ranges to handle dynamic IP allocation across Azure regions
# GitHub Copilot uses many IPs within these ranges, requiring broader CIDR blocks
azure_ip_ranges:
  - cidr: "20.189.0.0/16"
    comment: "Azure WestUS2 (GitHub Copilot - broad range due to dynamic IP allocation)"
  - cidr: "104.208.0.0/16"
    comment: "Azure EastUS (GitHub Copilot - broad range due to dynamic IP allocation)"
  - cidr: "52.168.0.0/16"
    comment: "Azure EastUS2 (GitHub Copilot - covers .112 and .117, broad range)"
  - cidr: "40.79.0.0/16"
    comment: "Azure WestUS (GitHub Copilot - broad range due to dynamic IP allocation)"
  - cidr: "13.89.0.0/16"
    comment: "Azure EastUS (GitHub Copilot - broad range due to dynamic IP allocation)"
  - cidr: "13.69.0.0/16"
    comment: "Azure (covers .239, broad range due to dynamic IP allocation)"
  - cidr: "13.66.0.0/16"
    comment: "Azure WestUS2 (VS Code sync service - broad range)"
  - cidr: "20.42.0.0/16"
    comment: "Azure WestEurope (covers .65 and .73, broad range)"
  - cidr: "20.50.0.0/16"
    comment: "Azure (covers .80, broad range due to dynamic IP allocation)"

# Core infrastructure domains (not provider-specific)
core_domains:
  # Package managers
  ruby:
    - "rubygems.org"
    - "api.rubygems.org"
    - "index.rubygems.org"

  javascript:
    - "registry.npmjs.org"
    - "registry.yarnpkg.com"

  # GitHub infrastructure (always required)
  github:
    - "github.com"
    - "api.github.com"
    - "raw.githubusercontent.com"
    - "objects.githubusercontent.com"
    - "gist.githubusercontent.com"
    - "cloud.githubusercontent.com"

  # CDN and general infrastructure
  cdn:
    - "cdn.jsdelivr.net"

  # VS Code services
  vscode:
    - "update.code.visualstudio.com"
    - "marketplace.visualstudio.com"
    - "vscode.blob.core.windows.net"
    - "vscode.download.prss.microsoft.com"
    - "az764295.vo.msecnd.net"
    - "gallerycdn.vsassets.io"
    - "vscode.gallerycdn.vsassets.io"
    - "gallery.vsassets.io"
    - "vscode-sync.trafficmanager.net"
    - "vscode.dev"
    - "go.microsoft.com"
    - "download.visualstudio.microsoft.com"

  # Microsoft telemetry (optional, can be disabled)
  telemetry:
    - "dc.services.visualstudio.com"
    - "vortex.data.microsoft.com"

# Provider-specific domains
# These are collected from individual provider classes and merged here
provider_domains:
  # Anthropic (Claude)
  anthropic:
    - "api.anthropic.com"
    - "claude.ai"
    - "console.anthropic.com"

  # OpenAI
  openai:
    - "api.openai.com"
    - "auth.openai.com"
    - "openai.com"
    - "chat.openai.com"
    - "chatgpt.com"
    - "cdn.openai.com"
    - "oaiusercontent.com"

  # Google Gemini
  gemini:
    - "generativelanguage.googleapis.com"
    - "oauth2.googleapis.com"
    - "accounts.google.com"
    - "www.googleapis.com"

  # GitHub Copilot
  github_copilot:
    - "copilot-proxy.githubusercontent.com"
    - "api.githubcopilot.com"
    - "copilot-telemetry.githubusercontent.com"
    - "default.exp-tas.com"
    - "copilot-completions.githubusercontent.com"
    - "business.githubcopilot.com"
    - "enterprise.githubcopilot.com"
    - "individual.githubcopilot.com"

  # Cursor AI
  cursor:
    - "cursor.com"
    - "www.cursor.com"
    - "downloads.cursor.com"
    - "api.cursor.sh"
    - "cursor.sh"
    - "app.cursor.sh"
    - "www.cursor.sh"

  # Kilocode
  kilocode:
    - "kilocode.ai"
    - "api.kilocode.ai"

  # OpenCode
  opencode:
    - "api.opencode.ai"
    - "auth.opencode.ai"

  # OpenRouter
  openrouter:
    - "openrouter.ai"

# Dynamic IP sources
# These are fetched at runtime by the firewall script
dynamic_sources:
  github_meta_api:
    url: "https://api.github.com/meta"
    fields:
      - "git"
    comment: "GitHub Git protocol IP ranges (dynamically fetched)"
